# Taller Grupal 1: Programación Funcional Reactiva

**Semana:** 11  
**Asignatura:** Programación Funcional y Reactiva  

---

### Objetivos:
- Crear un `case class` en Scala para modelar datos específicos de un archivo CSV.
- Manipular colecciones de datos y realizar operaciones de filtrado y cálculos estadísticos.
- Aplicar fórmulas matemáticas (desviación estándar) mediante el uso de funciones de agregación y procesamiento funcional.

> [!IMPORTANT]
> Resolver el siguiente problema en grupos según proyecto integrador (**solo estudiantes presentes en el aula**). El archivo a utilizar es: [**`pi_movies_small.csv`**](https://www.dropbox.com/scl/fi/6o8verzfbvf0hg88k8wis/pi_movies_small.csv?rlkey=ava5ifceo886ds34oe8hvcf49&st=v9ga5hih&dl=0). Los estudiantes deben desarrollar toda la solución (definición de estructura, lectura y análisis) en **un mismo archivo de Scala**. **No deben entregar/subir el archivo**, el trabajo se presenta directamente al docente en el aula.

---

### Parte 1: Definición de case class y lectura de archivo

1. **Definición de la estructura:** Cree una `case class` llamada `Movie` que permita leer las siguientes columnas del archivo CSV: `adult`, `revenue`, `budget`, `vote_count` e `id`.
2. **Tipado de datos:** Configure los atributos de la siguiente manera para asegurar un procesamiento correcto:
    - `adult`: `Boolean`
    - `revenue`: `Double`
    - `budget`: `Double`
    - `vote_count`: `Int`
    - `id`: `Int`
3. **Implementación de lectura:** Utilizando la librería `fs2-data-csv` y el stack de `Cats Effect`, realice la lectura del archivo y convierta los datos en una lista de objetos de tipo `Movie`. Recuerde que el delimitador del archivo es punto y coma (`;`).

---

<img width="679" height="383" alt="image" src="https://github.com/user-attachments/assets/19841a98-fda9-4fb4-b1ec-6769b64a9564" />

### Parte 2: Análisis de datos

Utilizando la lista de objetos obtenida en la parte anterior, implemente la lógica dentro del mismo programa para resolver los siguientes requerimientos:

1. **Filtrado por ingresos:** Obtenga y muestre una lista (o el conteo) de todas las películas cuyo `revenue` (ingresos) sea estrictamente mayor al promedio de ingresos de todo el conjunto de datos.
2. **Cálculo de la desviación estándar:** Calcule la desviación estándar del presupuesto (`budget`) aplicando la siguiente fórmula:



[Image of standard deviation formula]


$$
\sigma = \sqrt{\frac{\sum_{i=1}^{n} (x_i - \overline{x})^2}{n}}
$$

Donde:
- $x_i$: es el **budget** de cada película.
- $\overline{x}$: es el promedio de los **budget**.
- $n$: es el número total de películas procesadas.

> **Instrucciones de desarrollo:** Trabajar en un único archivo fuente de Scala que contenga la `case class` y toda la lógica de procesamiento para ser revisado por el docente.

---
<img width="738" height="627" alt="image" src="https://github.com/user-attachments/assets/2c1e3572-e809-4e49-b800-a9d1625f74b7" />

```scala

package clases.semana11.trabajoGrupal

import cats.effect.{IO, IOApp}
import fs2.io.file.{Files, Path}
import fs2.text
import fs2.data.csv.*
import fs2.data.csv.generic.semiauto.*


case class Movie(
                  adult: Boolean,
                  revenue: Double,
                  budget: Double,
                  vote_count: Int,
                  id: String)

given CsvRowDecoder[Movie, String] = deriveCsvRowDecoder[Movie]

object Taller extends IOApp.Simple:
  val path = Path ("C:\\Users\\User\\IdeaProjects\\clasesVirtual1.sbt\\src\\main\\resources\\data\\pi_movies_small (1).csv")

  val run: IO[Unit] =
    Files[IO]
      .readAll(path)
      .through(text.utf8.decode)
      .through(decodeUsingHeaders[Movie](';'))
      .compile
      .toList
      .flatMap { movies =>


        val totalMovies = movies.length


        val revenues = movies.map(_.revenue)
        val revenueAvg = revenues.sum / revenues.length


        val moviesAboveAvg =
          movies.filter(_.revenue > revenueAvg)

        val budgets = movies.map(_.budget)
        val budgetAvg = budgets.sum / budgets.length

        val variance =
          budgets
            .map(b => math.pow(b - budgetAvg, 2))
            .sum / budgets.length

        val stdDeviation = math.sqrt(variance)


        IO.println(s"Total de películas procesadas: $totalMovies") >>
          IO.println(f"Promedio de ingresos (revenue): $revenueAvg%.2f") >>
          IO.println(s"Películas con ingresos mayores al promedio: ${moviesAboveAvg.length}") >>
          IO.println(f"Desviación estándar del presupuesto (budget): $stdDeviation%.2f")
      }
--- 
### ✅ Calificación:

Una vez que termine debe presentar su trabajo a su docente.

- **10 puntos:** si presenta en el horario de prácticas y experimentación.
- **7 puntos:** si presenta en el horario de tutoría.

**La hora máxima de presentación será las 16h30.**
